<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>DAO by abramadams</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/abramadams/dao">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/abramadams/dao/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/abramadams/dao/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>DAO</h1>
          <p>A ColdFusion library for easy Data Access and Object Mapping</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/abramadams">abramadams</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a id="dao---a-coldfusion-library-for-easy-data-access-and-object-mapping" class="anchor" href="#dao---a-coldfusion-library-for-easy-data-access-and-object-mapping" aria-hidden="true"><span class="octicon octicon-link"></span></a>dao - A ColdFusion library for easy Data Access and Object Mapping.</h1>

<h1>
<a id="disclaimer" class="anchor" href="#disclaimer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Disclaimer</h1>

<p>Though I have been using this library for many years on many, many projects, it has never been used or tested outside
of my control, so there are absolutely-positively things that are missing, and things that are just plain old broke.  There's also
a lot of ugly code in there, If you stumble on something, raise an issue (or submit a pull request :) )</p>

<p>Also, the bulk of the dao.cfc stuff was developed in CF7-8 erra, and has been patched CF9/10 features started creeping in.  I 
am in the process of re-writing the library using the query.cfc and some other things that will break the pre-CF9 compatibility.
For instance, this is being re-written using all script based code.</p>

<h1>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h1>

<p>The goal of this library is to allow one to interact with the database in a DB platform agnostic way, 
while making it super easy.  </p>

<p>There are two parts to this library, the first is for a more traditional DAO
type interaction where one uses a handful of CRUD functions:</p>

<ul>
<li><code>dao.insert()</code></li>
<li><code>dao.read()</code></li>
<li><code>dao.update()</code></li>
<li><code>dao.delete()</code></li>
</ul>

<p>as well as a general <code>dao.execute()</code> to run arbitrary SQL against the database.</p>

<p>Using the built-in methods for CRUD provides some benefits such as being database agnostic,
providing optional "onFinish" callbacks functions, transaction logging (for custom replication).</p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Copy the "database" folder <code>(/src/com/database)</code> into your project (or into the folder you place your components)</p>

<h1>
<a id="dao-examples" class="anchor" href="#dao-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>DAO Examples:</h1>

<div class="highlight highlight-javascript"><pre>    <span class="pl-c">// create instance of DAO - must feed it a datasource name</span>
    dao <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">com.database</span>.dao( dsn <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>dao<span class="pl-pds">"</span></span> ); <span class="pl-c">// note: dbtype is optional and defaults to MySQL</span>

    <span class="pl-c">// Insert data (could have easily been a form struct)</span>
    DATA <span class="pl-k">=</span> { 
            <span class="pl-s1"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span> <span class="pl-k">=</span> lcase(createUUID()), 
            <span class="pl-s1"><span class="pl-pds">"</span>first_name<span class="pl-pds">"</span></span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Joe<span class="pl-pds">"</span></span> , 
            <span class="pl-s1"><span class="pl-pds">"</span>last_name<span class="pl-pds">"</span></span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Shmo<span class="pl-pds">"</span></span>, 
            <span class="pl-s1"><span class="pl-pds">"</span>email<span class="pl-pds">"</span></span> <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>jshmo@blahblah.com<span class="pl-pds">"</span></span>, 
            <span class="pl-s1"><span class="pl-pds">"</span>created_datetime<span class="pl-pds">"</span></span> <span class="pl-k">=</span> now()
        };

    newID <span class="pl-k">=</span> dao.insert( table <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span>, data <span class="pl-k">=</span> DATA );
    <span class="pl-c">// newID would contain the record's auto-incremented PK value</span>

    <span class="pl-c">// DAO has a method queryParam() that wraps your values in </span>
    <span class="pl-c">// appropriate cfqueryparam tags.  The method takes 4 args:</span>
    <span class="pl-c">// value - required</span>
    <span class="pl-c">// cfsqltype - optional, will be guessed based on value.  Uses</span>
    <span class="pl-c">// common data type names, no need for the cf_sql_type... crap.</span>
    <span class="pl-c">// list - true/false; will pass to cfqueryparam list attribute</span>
    <span class="pl-c">// null - true/false; will pass to the cfqueryparam null attribute</span>

    <span class="pl-c">// Insert data (using mysql specific replace into syntax )</span>
    newID2 <span class="pl-k">=</span> dao.execute(<span class="pl-s1"><span class="pl-pds">"</span></span>
<span class="pl-s1">        REPLACE INTO users (id, `_id`, first_name, last_name, email, created_datetime)</span>
<span class="pl-s1">        VALUES ( 1</span>
<span class="pl-s1">                ,#dao.queryParam(lcase(createUUID()),'varchar')#</span>
<span class="pl-s1">                ,#dao.queryParam('john')#</span>
<span class="pl-s1">                ,#dao.queryParam('deere')#</span>
<span class="pl-s1">                ,#dao.queryParam('jdeere@tractor.com')#</span>
<span class="pl-s1">                ,#dao.queryParam(now(), 'timestamp')#</span>
<span class="pl-s1">               )</span>
<span class="pl-s1">    <span class="pl-pds">"</span></span>);
    <span class="pl-c">// newID2 would also contain the record's new PK value</span>
    <span class="pl-c">//This is true for insert and replace statements only.</span>

    <span class="pl-c">// Return all records in a table</span>
    users <span class="pl-k">=</span> dao.read( <span class="pl-s1"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span> );

    <span class="pl-c">// Return all records using SQL - and cache it</span>
    users <span class="pl-k">=</span> dao.read( 
        sql <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>SELECT first_name, last_name FROM users<span class="pl-pds">"</span></span>,
        cachedWithin <span class="pl-k">=</span> createTimeSpan(<span class="pl-c1">0</span>,<span class="pl-c1">0</span>,<span class="pl-c1">2</span>,<span class="pl-c1">0</span>)
    );
</pre></div>

<h1>
<a id="the-ormsh-side-of-dao" class="anchor" href="#the-ormsh-side-of-dao" aria-hidden="true"><span class="octicon octicon-link"></span></a>The ORM'sh side of DAO</h1>

<p>The second part of this library is an ORM'sh implementation of entity management.  It internally uses the 
dao.cfc (and dbtype specific CFCs), but provides an object oriented way of playing with your model.  Consider
the following examples:</p>

<div class="highlight highlight-javascript"><pre>    <span class="pl-c">// create instance of dao ( could be injected via your favorite DI library )</span>
    dao <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">dao</span>( dsn <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>dao<span class="pl-pds">"</span></span> );

    <span class="pl-c">// Suppose we have a model/User.cfc model cfc that extends "BaseModelObject.cfc"</span>
    user <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">model.User</span>( dao );

    <span class="pl-c">// Create a new user named john.</span>
    user.setFirstName( <span class="pl-s1"><span class="pl-pds">'</span>john<span class="pl-pds">'</span></span> );
    user.setLastName( <span class="pl-s1"><span class="pl-pds">'</span>deere<span class="pl-pds">'</span></span> );
    user.setEmail(<span class="pl-s1"><span class="pl-pds">'</span>jdeere@tractor.com<span class="pl-pds">'</span></span>);

    <span class="pl-c">// Save will insert the new record because it doesn't exist.  </span>
    <span class="pl-c">// If we had loaded the entity with a user record, it would perform an update.</span>
    user.save();

    <span class="pl-c">// So the entity has been persisted to the database.  If we wanted</span>
    <span class="pl-c">// to at this point, we could use the user.getID() method to get the</span>
    <span class="pl-c">// value of the newly created PK.  Or we could do another update</span>
    user.setFirstName(<span class="pl-s1"><span class="pl-pds">'</span>Johnny<span class="pl-pds">'</span></span>);
    user.save(); <span class="pl-c">// Now the entity has been "updated" and persisted to the databse.</span>

    <span class="pl-c">// Now, to load data into an entity it's as simple as:</span>
    user <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">model.User</span>( dao );
    user.<span class="pl-s3">load</span>(<span class="pl-c1">1</span>);  <span class="pl-c">// assuming our record's ID == 1</span>

    <span class="pl-c">// We can also do crazy stuff like:</span>
    user.loadByFirstNameAndLastName(<span class="pl-s1"><span class="pl-pds">'</span>Johnny<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>deere<span class="pl-pds">'</span></span>);
    <span class="pl-c">// Every property/field in the entity can be included in this dynamic load function </span>
    <span class="pl-c">// just prefix the function name as "loadBy" and delimit the field name criteria by "And"</span>
    user.loadByFirstNameAndLastNameAndEmailAndIDAndCreatedDate(....);

    <span class="pl-c">// A model entity can also be used to load collections, not just a single member</span>
    user <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">model.User</span>( dao );
    users <span class="pl-k">=</span> user.loadAll(); <span class="pl-c">// &lt;--- returns array of intitialized entity objects - one for each record</span>

    <span class="pl-c">// you can also filter using the dynamic load function</span>
    users <span class="pl-k">=</span> user.loadAllByFirstName(<span class="pl-s1"><span class="pl-pds">'</span>Johnny<span class="pl-pds">'</span></span>);

    <span class="pl-c">// there is also a list function that will return a query object</span>
    users <span class="pl-k">=</span> user.list( where <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>FirstName = 'Johnny' <span class="pl-pds">"</span></span>);

    <span class="pl-c">// Even more coolness. We can return the entity (or collection) as an array, or JSON, or struct!</span>
    user.toStruct();
    user.toJSON(); <span class="pl-c">// &lt;--- know that this is not the ACF to JSON crap, it's real serialized JSON.</span>

    <span class="pl-c">// Collection return types</span>
    users <span class="pl-k">=</span> user.listAsArray( where <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>FirstName = 'Johnny' <span class="pl-pds">"</span></span>);
    users <span class="pl-k">=</span> user.listAsJSON( where <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>FirstName = 'Johnny' <span class="pl-pds">"</span></span>);
</pre></div>

<p>That's the very basics of Entity management in DAO.  It get's real interesting when you start playing with
relationships.  By-in-large I have adopted the property syntax used by CF ORM to define
entity properties and describe relationships.  Example: </p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">/* Pet.cfc */</span>
component persistent<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> table<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>pets<span class="pl-pds">"</span></span> <span class="pl-s">extends</span><span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>com.database.BaseModelObject<span class="pl-pds">"</span></span> accessors<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> {

    property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>ID<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>numeric<span class="pl-pds">"</span></span> fieldtype<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> generator<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>increment<span class="pl-pds">"</span></span>;
    property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>_id<span class="pl-pds">"</span></span> fieldtype<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> generator<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>uuid<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span> length<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>45<span class="pl-pds">"</span></span>;
    property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>userID<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>numeric<span class="pl-pds">"</span></span> sqltype<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>int<span class="pl-pds">"</span></span>;
    property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>firstName<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span> column<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>first_name<span class="pl-pds">"</span></span>;
    property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>lastName<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span> column<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>last_name<span class="pl-pds">"</span></span>;  
    property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>createdDate<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span> column<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>created_datetime<span class="pl-pds">"</span></span>;
    property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>modifiedDate<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span> column<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>modified_datetime<span class="pl-pds">"</span></span> formula<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>now()<span class="pl-pds">"</span></span>;

    <span class="pl-c">/* Relationships */</span>
    property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span> inverseJoinColumn<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>ID<span class="pl-pds">"</span></span> cascade<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>save-update<span class="pl-pds">"</span></span> fieldType<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>one-to-one<span class="pl-pds">"</span></span> fkcolumn<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>userID<span class="pl-pds">"</span></span> cfc<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>model.User<span class="pl-pds">"</span></span>;
    property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>offspring<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>array<span class="pl-pds">"</span></span> fieldType<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>one-to-many<span class="pl-pds">"</span></span> singularname<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>kid<span class="pl-pds">"</span></span> fkcolumn<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>offspringID<span class="pl-pds">"</span></span> cfc<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>model.Offspring<span class="pl-pds">"</span></span>;

    <span class="pl-s">public</span> string <span class="pl-st">function</span> <span class="pl-en">getFullName</span>(){
        <span class="pl-k">return</span> variables.firstName <span class="pl-k">&amp;</span> <span class="pl-s1"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span> <span class="pl-k">&amp;</span> variables.lastName;
    }
}</pre></div>

<p>When in development you can have dao create your tables for you by passing the dropcreate = true to the initializer.  Exmaple:</p>

<div class="highlight highlight-javascript"><pre>    user <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">User</span>( dao <span class="pl-k">=</span> dao, dropCreate <span class="pl-k">=</span> <span class="pl-c1">true</span> );</pre></div>

<p>This will inspect your CFC properties and create a table based on those details.  This supports having different property names vs column names, table names, data types, etc...</p>

<p>The "Pet.cfc" above would create a table named <code>pets</code> with an auto incrementing PK name <code>ID</code>, a "varchar(45)" <code>_id</code> field, a <code>userID</code> field with the type "Int"
varchar fields named <code>first_name</code> and <code>last_name</code> a datetime field named <code>created_datetime</code> and a datetime field named <code>modified_datetime</code>.</p>

<ul>
<li>The _id field, will automatically generate a UUID value when a record is first created because we specified a generator UUID.</li>
<li>The getters/setters for first_name, last_name, craeted_datetime, modified_datetime would be:

<ul>
<li>get/setFirstName();</li>
<li>get/setLastName();</li>
<li>get/setCreatedDate();</li>
<li>get/setModifiedDate();</li>
</ul>
</li>
<li>The modifiedDate will update with the evaluated value of "now()" each time the data is updated.</li>
<li>The dynamic load statements respect the name/column differences, so the loadByFirstName("?") will essentially translate to "first_name = ?"</li>
</ul>

<h2>
<a id="dynamic-entities" class="anchor" href="#dynamic-entities" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dynamic Entities</h2>

<p>Sometimes it's a pain in the arse to create entity CFCs that just point to a single table.  You must create properties for each field in the table.  This feature will allow you to define an entity class with minimal effort.  Here's an example of a dynamic entity CFC:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">/* EventLog.cfc */</span>
component persistent<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> table<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>eventLog<span class="pl-pds">"</span></span> <span class="pl-s">extends</span><span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>com.database.BaseModelObject<span class="pl-pds">"</span></span>{
}</pre></div>

<p>That's all we <em>need</em>.  Now say I created a table named eventLog in my databse with the following:</p>

<div class="highlight highlight-sql"><pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> `<span class="pl-en">eventLog</span>` (
  <span class="pl-s1"><span class="pl-pds">`</span>ID<span class="pl-pds">`</span></span> <span class="pl-st">int</span>(<span class="pl-c1">11</span>) <span class="pl-k">NOT NULL</span> AUTO_INCREMENT,
  <span class="pl-s1"><span class="pl-pds">`</span>event<span class="pl-pds">`</span></span> <span class="pl-st">varchar</span>(<span class="pl-c1">100</span>) DEFAULT <span class="pl-k">NULL</span>,
  <span class="pl-s1"><span class="pl-pds">`</span>description<span class="pl-pds">`</span></span> <span class="pl-st">text</span>,
  <span class="pl-s1"><span class="pl-pds">`</span>eventDate<span class="pl-pds">`</span></span> datetime DEFAULT <span class="pl-k">NULL</span>,
  <span class="pl-s">PRIMARY KEY</span> (<span class="pl-s1"><span class="pl-pds">`</span>ID<span class="pl-pds">`</span></span>)
);</pre></div>

<p>When I instantiate the EventLog.cfc with:</p>

<div class="highlight highlight-javascript"><pre>eventLog <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">model.EventLog</span>( dao <span class="pl-k">=</span> dao );</pre></div>

<p>I'll get an instance of EventLog as if the CFC had included the following properties:</p>

<div class="highlight highlight-javascript"><pre>property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>ID<span class="pl-pds">"</span></span> fieldtype<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span> generator<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>increment<span class="pl-pds">"</span></span>;
property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>event<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>;
property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>;
property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>eventDate<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>date<span class="pl-pds">"</span></span>;</pre></div>

<p>To make this work, just make sure you set the table attribute to point to the actual table in the database, extend BaseModelObject and set the persistent=true.  When you then create an instance of that CFC, the table (eventLog in the above example) will be examined and all the fields in that table will be injected into your instance - along with all the getters/setters.  This even works with identity fields (i.e. Primary Keys) and auto generated (i.e. increment) fields.</p>

<p>You can also mix and match.  You can statically define properties:</p>

<div class="highlight highlight-javascript"><pre>component persistent<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> table<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>eventLog<span class="pl-pds">"</span></span> <span class="pl-s">extends</span><span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>com.database.BaseModelObject<span class="pl-pds">"</span></span> accessors<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>{
    property name<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span> type<span class="pl-k">=</span><span class="pl-s1"><span class="pl-pds">"</span>string<span class="pl-pds">"</span></span>;
}</pre></div>

<p>And DAO will just inject the rest of the columns.  This is handy in cases where your table definition has been altered (i.e. new fields) as they will automatically be included.  For anything more than straight table entities (i.e. you need relationships, formulas, etc...) you still need to declare those properties in the CFC.  You also must statically define properties where you want the property name to be different than the table's column name. (NOTE: the DAO is smart enough to check for both when injecting properties)</p>

<h3>
<a id="dynamic-entity---a-step-further" class="anchor" href="#dynamic-entity---a-step-further" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dynamic Entity - A step further</h3>

<p>I believe it's best to create entity CFCs that extend BaseModelObject, but... for dynamic entities you don't necessarily have to.  Here's what we could have done above without having to create EventLog.cfc:</p>

<div class="highlight highlight-javascript"><pre>eventLog <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">com.database</span>.BaseModelObject( dao <span class="pl-k">=</span> dao, table <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>eventLog<span class="pl-pds">'</span></span> );</pre></div>

<p>That would have returned an entity instance with all the properties from the eventLog table.  I'm not saying this is a best practice, but it is possible.  It hasn't been tested in the wild, so YMMV - but it passes our internal manual tests.</p>

<h2>
<a id="relationships" class="anchor" href="#relationships" aria-hidden="true"><span class="octicon octicon-link"></span></a>Relationships</h2>

<p>Since this Pet.cfc defines a one-to-one relationship with the user, this will automatically load the correct "User" object into the Pet object
when the Pet object is instantiated.  If none exists it will load an un-initialized instance of User.  When a save is performed on Pet, the User
is also evaluated and saved (if any changes were detected ).</p>

<p>One can also identify one-to-many relationships. This will also auto-load and "cascade" save unless told otherwise via the "cascade" attribute. This type of
relationship creates an Array of whatever object it is related to, and adds the <code>add&lt;Entity Name&gt;()</code> method to the instance so you can add instances to the array.  Notice in 
our Pets.cfc example we define a one-to-many relationship of "offspring" which maps to "model.Offspring".</p>

<h2>
<a id="lazy-loading" class="anchor" href="#lazy-loading" aria-hidden="true"><span class="octicon octicon-link"></span></a>lazy loading</h2>

<p>If you are fortunate enough to be on Railo 4x or ACF10+ you can take advantage of lazy loading.  This dramatically improves performance when loading entities with a lot of related
entities, or are loading a collection of entities that have related entities.  What it will do is load the parent entity and "overload" the getters methods of the child entities
with a customized getter that will first instantiate/load the child object, then return it's value.  This way, only child entities that are actually used/referenced will be loaded.</p>

<p>To lazy load, you simply use the dynamic load method, prefixed with "lazy"</p>

<div class="highlight highlight-javascript"><pre>pet <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Pet</span>( dao ).lazyLoadAll();
<span class="pl-c">// then, if I only need the first name of the "user" for the second pet I'd just:</span>
ownerName <span class="pl-k">=</span> pet[<span class="pl-c1">2</span>].getFirstName();  <span class="pl-c">// That would trigger the "load" on only the that pet's user object.</span></pre></div>

<h1>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h1>

<p>Currently this library has been actively used and tested on Railo 4x, CF9 and CF10 (though the dao.cfc stuff should work with CF8 - for now). 
There are some features that are disabled by default ( such as lazy loading child entities ), but can be "turned on" by un-commenting
a few lines if you are running on CF10+ or Railo 4+ (uses anonymous functions)</p>

<h1>
<a id="database-platform-agnostic" class="anchor" href="#database-platform-agnostic" aria-hidden="true"><span class="octicon octicon-link"></span></a>Database Platform Agnostic</h1>

<p>Currently there are two databases that are supported: MySQL and MS SQL.  Others can be added by
creating a new CFC that implements the necessary methods.  The CFC  name would then be the "dbtype"
argument passed to the init method when instantiating dao.cfc.  So if you have otherrdbs.cfc, you'd
instantiate as: dao = new dao( dbType = 'otherrdbs' );</p>

<h1>
<a id="more-examples" class="anchor" href="#more-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>More examples</h1>

<p>Check out the daotest.cfm and entitytest.cfm files for a basic examples of the various features.</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>